<div class="diet-container">
  <div class="page-header">
    <h2>🍽️ Diário Alimentar</h2>
    <p class="page-subtitle">Clique em um dia para ver ou registrar suas refeições</p>
  </div>

  <!-- Calendário Mensal -->
  <div class="calendar-card">
    <div class="calendar-header">
      <button class="nav-btn" (click)="prevMonth()" title="Mês anterior">◀</button>
      <h3>{{ monthNames[currentMonth] }} {{ currentYear }}</h3>
      <button class="nav-btn" (click)="nextMonth()" title="Próximo mês">▶</button>
    </div>

    <div class="calendar-grid">
      <div class="weekday-header">Dom</div>
      <div class="weekday-header">Seg</div>
      <div class="weekday-header">Ter</div>
      <div class="weekday-header">Qua</div>
      <div class="weekday-header">Qui</div>
      <div class="weekday-header">Sex</div>
      <div class="weekday-header">Sáb</div>

      <ng-container *ngFor="let week of weeks">
        <div
          *ngFor="let cell of week"
          class="calendar-day"
          [class.in-month]="cell.inMonth"
          [class.has-log]="hasLogOnDate(cell.dateStr)"
          (click)="onDayClick(cell)"
          [attr.title]="cell.inMonth ? 'Dia ' + cell.day : ''">
          <span class="day-number">{{ cell.day || '' }}</span>
          <span class="log-indicator" *ngIf="hasLogOnDate(cell.dateStr)">🍽️</span>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Modal do Dia -->
  <div class="modal-backdrop" *ngIf="showDayModal" (click)="closeDayModal()">
    <div class="modal-card day-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>📅 {{ selectedDate | datePt }}</h3>
        <button class="close-btn" (click)="closeDayModal()" title="Fechar">✖</button>
      </div>

      <div class="modal-body">
        <!-- Modo Visualização -->
        <div *ngIf="!isEditing && selectedLog">
          <div class="meals-list">
            <div class="meal-item" *ngIf="selectedLog.breakfast">
              <div class="meal-label">☕ Café da Manhã</div>
              <div class="meal-content">{{ selectedLog.breakfast }}</div>
            </div>

            <div class="meal-item" *ngIf="selectedLog.lunch">
              <div class="meal-label">🍚 Almoço</div>
              <div class="meal-content">{{ selectedLog.lunch }}</div>
            </div>

            <div class="meal-item" *ngIf="selectedLog.dinner">
              <div class="meal-label">🥗 Jantar</div>
              <div class="meal-content">{{ selectedLog.dinner }}</div>
            </div>

            <div class="meal-item" *ngIf="selectedLog.snacks">
              <div class="meal-label">🍎 Lanches</div>
              <div class="meal-content">{{ selectedLog.snacks }}</div>
            </div>
          </div>

          <div class="notes-section" *ngIf="selectedLog.notes">
            <div class="notes-label">📝 Observações</div>
            <div class="notes-content">{{ selectedLog.notes }}</div>
          </div>

          <div class="modal-actions">
            <button class="btn-edit" (click)="startEdit()">✏️ Editar</button>
            <button class="btn-delete" (click)="openDeleteModal()">🗑️ Excluir</button>
          </div>
        </div>

        <!-- Sem registro -->
        <div *ngIf="!isEditing && !selectedLog" class="empty-day">
          <p>Nenhuma refeição registrada neste dia.</p>
          <button class="btn-primary" (click)="startNewLog()">➕ Registrar Refeições</button>
        </div>

        <!-- Modo Edição/Criação -->
        <div *ngIf="isEditing" class="edit-form">
          <div class="form-group">
            <label for="breakfast">☕ Café da Manhã</label>
            <textarea id="breakfast" [(ngModel)]="editedLog.breakfast" placeholder="Ex: Pão integral, ovo..."></textarea>
          </div>

          <div class="form-group">
            <label for="lunch">🍚 Almoço</label>
            <textarea id="lunch" [(ngModel)]="editedLog.lunch" placeholder="Ex: Arroz, feijão, frango..."></textarea>
          </div>

          <div class="form-group">
            <label for="dinner">🥗 Jantar</label>
            <textarea id="dinner" [(ngModel)]="editedLog.dinner" placeholder="Ex: Salada, peixe..."></textarea>
          </div>

          <div class="form-group">
            <label for="snacks">🍎 Lanches</label>
            <textarea id="snacks" [(ngModel)]="editedLog.snacks" placeholder="Ex: Frutas, iogurte..."></textarea>
          </div>

          <div class="form-group">
            <label for="notes">📝 Observações</label>
            <textarea id="notes" [(ngModel)]="editedLog.notes" placeholder="Anotações adicionais..."></textarea>
          </div>

          <div class="modal-actions">
            <button class="btn-primary" (click)="saveLog()">💾 Salvar</button>
            <button class="btn-cancel" (click)="cancelEdit()">Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmação de Exclusão -->
  <div class="modal-backdrop" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-card confirm-modal" (click)="$event.stopPropagation()">
      <h3>Confirmar exclusão</h3>
      <p>Tem certeza que deseja excluir este registro de alimentação?</p>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeDeleteModal()">Cancelar</button>
        <button class="btn-delete" (click)="confirmDelete()">Excluir</button>
      </div>
    </div>
  </div>

  <!-- Seção de Receitas -->
  <div class="recipes-section">
    <div class="section-header">
      <h3>📖 Minhas Receitas</h3>
      <p class="section-subtitle">Salve suas receitas favoritas para consultar quando precisar</p>
    </div>

    <!-- Formulário de Nova Receita -->
    <div class="recipe-form-card">
      <h4>➕ Adicionar Receita</h4>
      <div class="form-row">
        <div class="form-group">
          <label for="recipe-name">Nome da Receita</label>
          <input type="text" id="recipe-name" [(ngModel)]="newRecipe.name" placeholder="Ex: Bolo de Cenoura">
        </div>
        <div class="form-group">
          <label for="recipe-desc">Descrição / Ingredientes</label>
          <textarea id="recipe-desc" [(ngModel)]="newRecipe.description" placeholder="Descreva os ingredientes e modo de preparo..."></textarea>
        </div>
        <button class="btn-primary" (click)="addRecipe()">💾 Salvar Receita</button>
      </div>
    </div>

    <!-- Lista de Receitas -->
    <div class="recipes-list" *ngIf="recipes.length > 0">
      <div class="recipe-card" *ngFor="let recipe of recipes">
        <!-- Modo Visualização -->
        <div *ngIf="editingRecipeId !== recipe.id">
          <div class="recipe-header">
            <h4>{{ recipe.name }}</h4>
            <div class="recipe-actions">
              <button class="icon-btn edit" (click)="startEditRecipe(recipe)" title="Editar">✏️</button>
              <button class="icon-btn delete" (click)="openRecipeDeleteModal(recipe)" title="Excluir">🗑️</button>
            </div>
          </div>
          <p class="recipe-description">{{ recipe.description || 'Sem descrição' }}</p>
        </div>

        <!-- Modo Edição -->
        <div *ngIf="editingRecipeId === recipe.id" class="edit-recipe-form">
          <div class="form-group">
            <label>Nome da Receita</label>
            <input type="text" [(ngModel)]="editedRecipe.name" placeholder="Nome da receita">
          </div>
          <div class="form-group">
            <label>Descrição / Ingredientes</label>
            <textarea [(ngModel)]="editedRecipe.description" placeholder="Descrição e ingredientes"></textarea>
          </div>
          <div class="recipe-actions">
            <button class="icon-btn save" (click)="saveEditRecipe()" title="Salvar">✅</button>
            <button class="icon-btn cancel" (click)="cancelEditRecipe()" title="Cancelar">❌</button>
          </div>
        </div>
      </div>
    </div>

    <div class="empty-recipes" *ngIf="recipes.length === 0">
      <p>Nenhuma receita cadastrada ainda.</p>
    </div>
  </div>

  <!-- Modal de Confirmação de Exclusão de Receita -->
  <div class="modal-backdrop" *ngIf="showRecipeDeleteModal" (click)="closeRecipeDeleteModal()">
    <div class="modal-card confirm-modal" (click)="$event.stopPropagation()">
      <h3>Confirmar exclusão</h3>
      <p>Tem certeza que deseja excluir esta receita?</p>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeRecipeDeleteModal()">Cancelar</button>
        <button class="btn-delete" (click)="confirmRecipeDelete()">Excluir</button>
      </div>
    </div>
  </div>
</div>
