<div class="diet-container">
  <div class="page-header">
    <h2>ğŸ½ï¸ DiÃ¡rio Alimentar</h2>
    <p class="page-subtitle">Clique em um dia para ver ou registrar suas refeiÃ§Ãµes</p>
  </div>

  <!-- CalendÃ¡rio Mensal -->
  <div class="calendar-card">
    <div class="calendar-header">
      <button class="nav-btn" (click)="prevMonth()" title="MÃªs anterior">â—€</button>
      <h3>{{ monthNames[currentMonth] }} {{ currentYear }}</h3>
      <button class="nav-btn" (click)="nextMonth()" title="PrÃ³ximo mÃªs">â–¶</button>
    </div>

    <div class="calendar-grid">
      <div class="weekday-header">Dom</div>
      <div class="weekday-header">Seg</div>
      <div class="weekday-header">Ter</div>
      <div class="weekday-header">Qua</div>
      <div class="weekday-header">Qui</div>
      <div class="weekday-header">Sex</div>
      <div class="weekday-header">SÃ¡b</div>

      <ng-container *ngFor="let week of weeks">
        <div
          *ngFor="let cell of week"
          class="calendar-day"
          [class.in-month]="cell.inMonth"
          [class.has-log]="hasLogOnDate(cell.dateStr)"
          (click)="onDayClick(cell)"
          [attr.title]="cell.inMonth ? 'Dia ' + cell.day : ''">
          <span class="day-number">{{ cell.day || '' }}</span>
          <span class="log-indicator" *ngIf="hasLogOnDate(cell.dateStr)">ğŸ½ï¸</span>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Modal do Dia -->
  <div class="modal-backdrop" *ngIf="showDayModal" (click)="closeDayModal()">
    <div class="modal-card day-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“… {{ selectedDate | datePt }}</h3>
        <button class="close-btn" (click)="closeDayModal()" title="Fechar">âœ–</button>
      </div>

      <div class="modal-body">
        <!-- Modo VisualizaÃ§Ã£o -->
        <div *ngIf="!isEditing && selectedLog">
          <div class="meals-list">
            <div class="meal-item" *ngIf="selectedLog.breakfast">
              <div class="meal-label">â˜• CafÃ© da ManhÃ£</div>
              <div class="meal-content">{{ selectedLog.breakfast }}</div>
            </div>

            <div class="meal-item" *ngIf="selectedLog.lunch">
              <div class="meal-label">ğŸš AlmoÃ§o</div>
              <div class="meal-content">{{ selectedLog.lunch }}</div>
            </div>

            <div class="meal-item" *ngIf="selectedLog.dinner">
              <div class="meal-label">ğŸ¥— Jantar</div>
              <div class="meal-content">{{ selectedLog.dinner }}</div>
            </div>

            <div class="meal-item" *ngIf="selectedLog.snacks">
              <div class="meal-label">ğŸ Lanches</div>
              <div class="meal-content">{{ selectedLog.snacks }}</div>
            </div>
          </div>

          <div class="notes-section" *ngIf="selectedLog.notes">
            <div class="notes-label">ğŸ“ ObservaÃ§Ãµes</div>
            <div class="notes-content">{{ selectedLog.notes }}</div>
          </div>

          <div class="modal-actions">
            <button class="btn-edit" (click)="startEdit()">âœï¸ Editar</button>
            <button class="btn-delete" (click)="openDeleteModal()">ğŸ—‘ï¸ Excluir</button>
          </div>
        </div>

        <!-- Sem registro -->
        <div *ngIf="!isEditing && !selectedLog" class="empty-day">
          <p>Nenhuma refeiÃ§Ã£o registrada neste dia.</p>
          <button class="btn-primary" (click)="startNewLog()">â• Registrar RefeiÃ§Ãµes</button>
        </div>

        <!-- Modo EdiÃ§Ã£o/CriaÃ§Ã£o -->
        <div *ngIf="isEditing" class="edit-form">
          <div class="form-group">
            <label for="breakfast">â˜• CafÃ© da ManhÃ£</label>
            <textarea id="breakfast" [(ngModel)]="editedLog.breakfast" placeholder="Ex: PÃ£o integral, ovo..."></textarea>
          </div>

          <div class="form-group">
            <label for="lunch">ğŸš AlmoÃ§o</label>
            <textarea id="lunch" [(ngModel)]="editedLog.lunch" placeholder="Ex: Arroz, feijÃ£o, frango..."></textarea>
          </div>

          <div class="form-group">
            <label for="dinner">ğŸ¥— Jantar</label>
            <textarea id="dinner" [(ngModel)]="editedLog.dinner" placeholder="Ex: Salada, peixe..."></textarea>
          </div>

          <div class="form-group">
            <label for="snacks">ğŸ Lanches</label>
            <textarea id="snacks" [(ngModel)]="editedLog.snacks" placeholder="Ex: Frutas, iogurte..."></textarea>
          </div>

          <div class="form-group">
            <label for="notes">ğŸ“ ObservaÃ§Ãµes</label>
            <textarea id="notes" [(ngModel)]="editedLog.notes" placeholder="AnotaÃ§Ãµes adicionais..."></textarea>
          </div>

          <div class="modal-actions">
            <button class="btn-primary" (click)="saveLog()">ğŸ’¾ Salvar</button>
            <button class="btn-cancel" (click)="cancelEdit()">Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de ConfirmaÃ§Ã£o de ExclusÃ£o -->
  <div class="modal-backdrop" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-card confirm-modal" (click)="$event.stopPropagation()">
      <h3>Confirmar exclusÃ£o</h3>
      <p>Tem certeza que deseja excluir este registro de alimentaÃ§Ã£o?</p>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeDeleteModal()">Cancelar</button>
        <button class="btn-delete" (click)="confirmDelete()">Excluir</button>
      </div>
    </div>
  </div>

  <!-- SeÃ§Ã£o de Receitas -->
  <div class="recipes-section">
    <div class="section-header">
      <h3>ğŸ“– Minhas Receitas</h3>
      <p class="section-subtitle">Salve suas receitas favoritas para consultar quando precisar</p>
    </div>

    <!-- FormulÃ¡rio de Nova Receita -->
    <div class="recipe-form-card">
      <h4>â• Adicionar Receita</h4>
      <div class="form-row">
        <div class="form-group">
          <label for="recipe-name">Nome da Receita</label>
          <input type="text" id="recipe-name" [(ngModel)]="newRecipe.name" placeholder="Ex: Bolo de Cenoura">
        </div>
        <div class="form-group">
          <label for="recipe-desc">DescriÃ§Ã£o / Ingredientes</label>
          <textarea id="recipe-desc" [(ngModel)]="newRecipe.description" placeholder="Descreva os ingredientes e modo de preparo..."></textarea>
        </div>
        <button class="btn-primary" (click)="addRecipe()">ğŸ’¾ Salvar Receita</button>
      </div>
    </div>

    <!-- Lista de Receitas -->
    <div class="recipes-list" *ngIf="recipes.length > 0">
      <div class="recipe-card" *ngFor="let recipe of recipes">
        <!-- Modo VisualizaÃ§Ã£o -->
        <div *ngIf="editingRecipeId !== recipe.id">
          <div class="recipe-header">
            <h4>{{ recipe.name }}</h4>
            <div class="recipe-actions">
              <button class="icon-btn edit" (click)="startEditRecipe(recipe)" title="Editar">âœï¸</button>
              <button class="icon-btn delete" (click)="openRecipeDeleteModal(recipe)" title="Excluir">ğŸ—‘ï¸</button>
            </div>
          </div>
          <p class="recipe-description">{{ recipe.description || 'Sem descriÃ§Ã£o' }}</p>
        </div>

        <!-- Modo EdiÃ§Ã£o -->
        <div *ngIf="editingRecipeId === recipe.id" class="edit-recipe-form">
          <div class="form-group">
            <label>Nome da Receita</label>
            <input type="text" [(ngModel)]="editedRecipe.name" placeholder="Nome da receita">
          </div>
          <div class="form-group">
            <label>DescriÃ§Ã£o / Ingredientes</label>
            <textarea [(ngModel)]="editedRecipe.description" placeholder="DescriÃ§Ã£o e ingredientes"></textarea>
          </div>
          <div class="recipe-actions">
            <button class="icon-btn save" (click)="saveEditRecipe()" title="Salvar">âœ…</button>
            <button class="icon-btn cancel" (click)="cancelEditRecipe()" title="Cancelar">âŒ</button>
          </div>
        </div>
      </div>
    </div>

    <div class="empty-recipes" *ngIf="recipes.length === 0">
      <p>Nenhuma receita cadastrada ainda.</p>
    </div>
  </div>

  <!-- Modal de ConfirmaÃ§Ã£o de ExclusÃ£o de Receita -->
  <div class="modal-backdrop" *ngIf="showRecipeDeleteModal" (click)="closeRecipeDeleteModal()">
    <div class="modal-card confirm-modal" (click)="$event.stopPropagation()">
      <h3>Confirmar exclusÃ£o</h3>
      <p>Tem certeza que deseja excluir esta receita?</p>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeRecipeDeleteModal()">Cancelar</button>
        <button class="btn-delete" (click)="confirmRecipeDelete()">Excluir</button>
      </div>
    </div>
  </div>
</div>
