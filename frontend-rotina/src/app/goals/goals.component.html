<div class="goals-container">
  <div class="page-header">
    <h2>ðŸŽ¯ Metas e Objetivos</h2>
    <p class="page-subtitle">Defina e acompanhe suas metas de desenvolvimento</p>
  </div>

  <!-- Form Section -->
  <div class="form-card">
    <h3>âž• Nova Meta</h3>
    <form (ngSubmit)="addGoal()" class="goals-form">
      <div class="form-group full-width">
        <label for="description">DescriÃ§Ã£o da Meta *</label>
        <textarea id="description" [(ngModel)]="newGoal.description" name="description" placeholder="Ex: Correr 5km em menos de 30 minutos" required></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="type">Tipo de Meta *</label>
          <select id="type" [(ngModel)]="newGoal.type" name="type" required>
            <option value="WEEKLY">ðŸ“… Semanal</option>
            <option value="MONTHLY">ðŸ“† Mensal</option>
            <option value="YEARLY">ðŸ“Š Anual</option>
          </select>
        </div>

        <div class="form-group">
          <label for="startDate">Data de InÃ­cio</label>
          <input id="startDate" [(ngModel)]="newGoal.startDate" name="startDate" type="date" />
        </div>

        <div class="form-group">
          <label for="endDate">Data de ConclusÃ£o</label>
          <input id="endDate" [(ngModel)]="newGoal.endDate" name="endDate" type="date" />
        </div>
      </div>

      <button type="submit" class="btn-submit">ðŸŽ¯ Adicionar Meta</button>
    </form>
  </div>

  <!-- Goals Section -->
  <div class="goals-section">
    <h3>
      Suas Metas
      <span class="goal-count">{{ goals.length }}</span>
    </h3>

    <div class="goals-grid" *ngIf="goals.length > 0">
      <div class="goal-card" [ngClass]="g.type" *ngFor="let g of goals">

        <!-- If this goal is being edited show the edit form -->
        <div *ngIf="editingGoalId === g.id; else showGoal">
          <div class="form-group">
            <label>DescriÃ§Ã£o</label>
            <textarea [(ngModel)]="editedGoal.description" name="editDescription"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Tipo</label>
              <select [(ngModel)]="editedGoal.type" name="editType">
                <option value="WEEKLY">ðŸ“… Semanal</option>
                <option value="MONTHLY">ðŸ“† Mensal</option>
                <option value="YEARLY">ðŸ“Š Anual</option>
              </select>
            </div>
            <div class="form-group">
              <label>InÃ­cio</label>
              <input type="date" [(ngModel)]="editedGoal.startDate" name="editStart" />
            </div>
            <div class="form-group">
              <label>Fim</label>
              <input type="date" [(ngModel)]="editedGoal.endDate" name="editEnd" />
            </div>
          </div>
          <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
            <button class="btn-submit" (click)="saveEdit(g)">Salvar</button>
            <button class="btn-ghost" (click)="cancelEdit()">Cancelar</button>
          </div>
        </div>

        <!-- Read-only view -->
        <ng-template #showGoal>
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <span class="goal-type-badge">{{ g.type === 'WEEKLY' ? 'ðŸ“… Semanal' : g.type === 'MONTHLY' ? 'ðŸ“† Mensal' : 'ðŸ“Š Anual' }}</span>
            <div style="display:flex; gap:0.5rem;">
              <button class="btn-ghost" (click)="startEdit(g)">Editar</button>
              <button class="btn-ghost" (click)="deleteGoal(g)">Excluir</button>
            </div>
          </div>
          <div class="goal-description">{{ g.description }}</div>
          <div class="goal-dates" *ngIf="g.startDate || g.endDate">
            <div class="goal-date-item" *ngIf="g.startDate">
              <span class="goal-date-label">InÃ­cio</span>
              <span class="goal-date-value">{{ g.startDate | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="goal-date-item" *ngIf="g.endDate">
              <span class="goal-date-label">ConclusÃ£o</span>
              <span class="goal-date-value">{{ g.endDate | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
        </ng-template>

      </div>
    </div>

    <div class="empty-state" *ngIf="goals.length === 0">
      <div class="empty-state-icon">ðŸŽ¯</div>
      <p>Nenhuma meta definida ainda. Crie sua primeira meta acima!</p>
    </div>
  </div>
</div>
